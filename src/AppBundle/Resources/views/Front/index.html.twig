{% extends '@App/base.html.twig' %}
{% set institutionCode = "" %}
{% block body %}
    <div class="container-fluid">
        <h1 class="page-header row">{{ 'welcome' | trans({'%name%' : app.user},'user') }}</h1>

        {% if managedCollectionsByInstitution|length > 0 %}
            {% for institutionCode, managedCollections in managedCollectionsByInstitution %}
                <div class="row">
                    <div class="col-md-8">
                        <div class="panel panel-managed-collections">
                            <div class="panel-heading">
                                <h3 class="panel-title">
                                    {{ 'label.institution' | trans | capitalize }} : {{ institutionCode }}
                                </h3>
                            </div>
                            <div class="list-group">
                                {% for collection in managedCollections %}
                                    {% include '@App/Front/partial/managedCollection.html.twig' %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>
    {% include "@App/Front/partial/searchDiffModal.html.twig" %}
{% endblock %}
{#
{% block javascripts %}
    <script type="text/javascript">
        $(document).ready(function () {
            $("a.searchDiffButton").on('click', function (event) {
                event.preventDefault();
                $("#modal").modal({
                    backdrop: 'static',
                    keyboard: false
                }).modal('show');

                var progressbar = $("#modal").find(".progress-bar");
                var steps;

                try {
                    var source = new EventSource($(this).attr('href'));
                    source.onopen = function () {
                        return;
                    };
                    source.addEventListener('steps', function (evt) {
                        console.log(evt);
                        steps = parseInt(evt.data);
                    });
                    source.addEventListener('step', function (evt) {
                        data = jQuery.parseJSON(evt.data);
                        progress(parseInt(data.count) / steps * 100, progressbar, data.step);
                        if (parseInt(data.count) === steps) {
                            source.close();
                            window.location.reload();
                        }
                    });

                } catch (e) {
                    console.log(e);
                }
            });
            function progress(percent, $element, label) {
                $element.css('width', percent + "%").html(Math.ceil(percent) + "%");
                $element.parent().next().html(Translator.trans(label));
            }
        });


    </script>
{% endblock %}#}
