{% extends '@App/base.html.twig' %}

{% set collectionCode = collection.collectioncode %}
{% set institution = collection.institution %}
{% set selectedClassName = app.request.attributes.get('selectedClassName') %}
{% set db = app.request.attributes.get('db') %}

{% block body %}
    {% set datas = pagination.items %}
    {% if specimens is not empty %}
        <div id="wrapper" class="toggled">

            {#<div id="sidebar-wrapper">#}
                {#{% include '@App/Front/partial/sidebar_diffs.html.twig' with {'itemNumberPerPage' : pagination.getItemNumberPerPage, 'currentPage' : pagination.getCurrentPageNumber, 'choices':choicesFacets} %}#}
            {#</div>#}

            <div id="page-content-wrapper">
                {#{% include '@App/Front/partial/buttonHamburger.html.twig' %}#}
                {% include '@App/Front/partial/breadcrumb.html.twig' %}

                <div class="text-center">
                    <div style="display: inline-block; vertical-align: middle;">
                        {{ knp_pagination_render(pagination) }}
                    </div>
                    <div style="display: inline-block;vertical-align: middle;">
                        <label for="maxItemPerPage"
                               style="font-size: 0.85em; font-weight: 500;">{{ 'label.maxItemPerPage' | trans }}</label>
                        <select name="maxItemPerPage" id="maxItemPerPage">
                            <option value="5" {{ pagination.getItemNumberPerPage == 5 ? 'selected="true"':'' }}>5</option>
                            <option value="10" {{ pagination.getItemNumberPerPage == 10 ? 'selected="true"':'' }}>10</option>
                            <option value="20" {{ pagination.getItemNumberPerPage == 20 ? 'selected="true"':'' }}>20</option>
                            <option value="50" {{ pagination.getItemNumberPerPage == 50 ? 'selected="true"':'' }}>50</option>
                        </select>
                    </div>
                </div>
                <div id="diffs" data-collectionCode="{{ collectionCode }}" data-institutioncode="{{ institutionCode }}" data-selectedclassname="{{ selectedClassName }}">

                    {% include '@App/Front/partial/filters.html.twig' with { 'currentPage': pagination.getCurrentPageNumber} %}
                    {% for catalogNumber, records in specimens %}
                        {% for occurrenceid, specimen in records %}
                            {% include '@App/Front/partial/specimen/fullSpecimen.html.twig' with {'loop' : loop.parent.loop} %}
                        {% endfor %}
                    {% endfor %}

                    <div class="text-center">
                        <div style="display: inline-block; vertical-align: middle;">
                            {{ knp_pagination_render(pagination) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    {% include '@App/Front/partial/smallModal.html.twig' %}
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('assets/AppBundle/js/viewDiffs.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var $maxItemPerPage = $('#maxItemPerPage');
            if (localStorage.getItem('maxItemPerPage')) {
                $maxItemPerPage.val(localStorage.getItem('maxItemPerPage'));
                $.get(Routing.generate('setmaxitem', {'maxItem': localStorage.getItem('maxItemPerPage')}));
            }
            $maxItemPerPage.change(function () {
                {% if selectedClassName is not defined %}
                    {% set selectedClassName = "all" %}
                {% endif %}

                var url = "{{ path(app.request.attributes.get('_route'),{'db' : db, 'collectionCode' : collectionCode, 'maxItemPerPage': '_itemNum', 'selectedClassName' : selectedClassName}) }}";
                var maxItemPerPage = $maxItemPerPage.find(":selected").text();
                localStorage.setItem('maxItemPerPage', maxItemPerPage);
                jQuery(location).attr('href', url.replace('_itemNum', maxItemPerPage));
            });
        });
    </script>
{% endblock %}
